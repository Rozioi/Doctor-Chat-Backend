import { Bot, InlineKeyboard } from "grammy";

const bot = new Bot("8322768927:AAHy9zUG5Li0bFgW6gVYcvNKIQ_2r2bfaIc");

const createMainKeyboard = () => {
  return new InlineKeyboard()
    .webApp("üë®‚Äç‚öïÔ∏è –ù–∞–π—Ç–∏ –≤—Ä–∞—á–∞", "https://rozioi.pro")
    .row()
    .text("üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç", "how_it_works")
    .text("üí≥ –ì–∞—Ä–∞–Ω—Ç–∏—è –æ–ø–ª–∞—Ç—ã", "payment_guarantee")
    .row()
    .text("üë• –î–ª—è –≤—Ä–∞—á–µ–π", "for_doctors")
    .text("üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã", "contacts");
};

bot.command("start", async (ctx) => {
  const welcomeText = `üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É Doctor Chat!

–ú—ã ‚Äî –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –º–µ–∂–¥—É –ø–∞—Ü–∏–µ–Ω—Ç–∞–º–∏ –∏ –≤—Ä–∞—á–∞–º–∏:

‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
‚úÖ –ü–æ–¥–±–æ—Ä –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
‚úÖ –ó–∞—â–∏—Ç–∞ –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω
–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∏—Å–∫ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –≤—Ä–∞—á–∞ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!`;

  await ctx.reply(welcomeText, {
    reply_markup: createMainKeyboard(),
  });
});

bot.callbackQuery("how_it_works", async (ctx) => {
  await ctx.answerCallbackQuery();
  await ctx.editMessageText(
    `üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞:

*–î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤:*
1. üîç –í—ã–±–∏—Ä–∞–µ—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –≤—Ä–∞—á–∞
2. üí¨ –û–±—Å—É–∂–¥–∞–µ—Ç–µ –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
3. üí≥ –û–ø–ª–∞—á–∏–≤–∞–µ—Ç–µ —á–µ—Ä–µ–∑ –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É
4. ü©∫ –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
5. ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —É—Å–ª—É–≥–∏
6. üí∞ –í—Ä–∞—á –ø–æ–ª—É—á–∞–µ—Ç –æ–ø–ª–∞—Ç—É

*–ù–∞—à–∞ —Ä–æ–ª—å:*
‚Ä¢ –ì–∞—Ä–∞–Ω—Ç —á–µ—Å—Ç–Ω–æ–π —Å–¥–µ–ª–∫–∏
‚Ä¢ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
‚Ä¢ –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —É—Å–ª—É–≥`,
    {
      parse_mode: "Markdown",
      reply_markup: new InlineKeyboard()
        .webApp("üë®‚Äç‚öïÔ∏è –ù–∞–π—Ç–∏ –≤—Ä–∞—á–∞", "https://rozioi.pro")
        .row()
        .text("üîô –ù–∞–∑–∞–¥", "back_to_main"),
    },
  );
});

bot.callbackQuery("payment_guarantee", async (ctx) => {
  await ctx.answerCallbackQuery();
  await ctx.editMessageText(
    `üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏–π –∏ –æ–ø–ª–∞—Ç—ã:

*–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–µ–∂–µ–π:*
‚Ä¢ –°—Ä–µ–¥—Å—Ç–≤–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º —Å—á–µ—Ç–µ
‚Ä¢ –û–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤—Ä–∞—á—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤–∞—à–µ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
‚Ä¢ –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏ –Ω–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —É—Å–ª—É–≥–µ

*–ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã:*
1. –í—ã –≤–Ω–æ—Å–∏—Ç–µ –æ–ø–ª–∞—Ç—É –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
2. –ü–æ–ª—É—á–∞–µ—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å —É—Å–ª—É–≥–æ–π
4. –í—Ä–∞—á –ø–æ–ª—É—á–∞–µ—Ç –æ–ø–ª–∞—Ç—É

*–î–ª—è –≤—Ä–∞—á–µ–π:*
‚Ä¢ –ì–∞—Ä–∞–Ω—Ç–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –∑–∞ —Ä–∞–±–æ—Ç—É
‚Ä¢ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤`,
    {
      parse_mode: "Markdown",
      reply_markup: new InlineKeyboard()
        .webApp("üë®‚Äç‚öïÔ∏è –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫", "https://rozioi.pro")
        .row()
        .text("üîô –ù–∞–∑–∞–¥", "back_to_main"),
    },
  );
});

bot.callbackQuery("for_doctors", async (ctx) => {
  await ctx.answerCallbackQuery();
  await ctx.editMessageText(
    `üë®‚Äç‚öïÔ∏è –î–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:

*–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ –Ω–∞—à—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É:*

‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è –æ–ø–ª–∞—Ç—ã –∑–∞ –∫–∞–∂–¥—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
‚úÖ –ù–∏–∫–∞–∫–∏—Ö —Ä–∏—Å–∫–æ–≤ –Ω–µ–æ–ø–ª–∞—Ç—ã
‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7
‚úÖ –£–¥–æ–±–Ω—ã–π –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç

*–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è:*
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ –≤—Ä–∞—á
2. –ü—Ä–æ–π–¥–∏—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
3. –ù–∞—á–Ω–∏—Ç–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
4. –ü–æ–ª—É—á–∞–π—Ç–µ –æ–ø–ª–∞—Ç—É –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫

–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞–∫ –≤—Ä–∞—á –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º: doctors@rozioi.pro`,
    {
      parse_mode: "Markdown",
      reply_markup: new InlineKeyboard()
        .url("üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Ä–∞—á–∞", "https://rozioi.pro/doctor-registration")
        .row()
        .text("üîô –ù–∞–∑–∞–¥", "back_to_main"),
    },
  );
});

bot.callbackQuery("contacts", async (ctx) => {
  await ctx.answerCallbackQuery();
  await ctx.editMessageText(
    `üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

*–î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤:*
üìß support@rozioi.pro
üïí –ü–æ–¥–¥–µ—Ä–∂–∫–∞: 24/7

*–î–ª—è –≤—Ä–∞—á–µ–π:*
üìß doctors@rozioi.pro
üïí –ü–Ω-–ü—Ç: 9:00-18:00

*–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞:*
üìß partnership@rozioi.pro

–ú—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏!`,
    {
      parse_mode: "Markdown",
      reply_markup: new InlineKeyboard()
        .webApp("üë®‚Äç‚öïÔ∏è –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ", "https://rozioi.pro")
        .row()
        .text("üîô –ù–∞–∑–∞–¥", "back_to_main"),
    },
  );
});

bot.callbackQuery("back_to_main", async (ctx) => {
  await ctx.answerCallbackQuery();
  await ctx.editMessageText(
    `üëã –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É Doctor Chat!

–í–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –≤ –ø–æ–∏—Å–∫–µ –≤—Ä–∞—á–µ–π –∏ –≥–∞—Ä–∞–Ω—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤.`,
    {
      reply_markup: createMainKeyboard(),
    },
  );
});

bot.on("message", async (ctx) => {
  const message = ctx.message.text.toLowerCase();

  if (
    message.includes("–≤—Ä–∞—á") ||
    message.includes("—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç") ||
    message.includes("–¥–æ–∫—Ç–æ—Ä")
  ) {
    await ctx.reply(
      "üîç –ù–∞–π–¥–µ–º –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –≤—Ä–∞—á–∞ –¥–ª—è –≤–∞—Å! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—à—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.",
      {
        reply_markup: new InlineKeyboard().webApp(
          "üë®‚Äç‚öïÔ∏è –ù–∞–π—Ç–∏ –≤—Ä–∞—á–∞",
          "https://rozioi.pro",
        ),
      },
    );
  } else if (
    message.includes("–æ–ø–ª–∞—Ç") ||
    message.includes("–≥–∞—Ä–∞–Ω—Ç") ||
    message.includes("–±–µ–∑–æ–ø–∞—Å–Ω")
  ) {
    await ctx.reply(
      "üõ°Ô∏è –ú—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–µ–∂–µ–π! –°—Ä–µ–¥—Å—Ç–≤–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è —É –Ω–∞—Å –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.",
      {
        reply_markup: new InlineKeyboard().text(
          "üí≥ –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≥–∞—Ä–∞–Ω—Ç–∏—è—Ö",
          "payment_guarantee",
        ),
      },
    );
  } else if (
    message.includes("—è –≤—Ä–∞—á") ||
    message.includes("–º–µ–¥–∏–∫") ||
    message.includes("—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç")
  ) {
    await ctx.reply(
      "üë®‚Äç‚öïÔ∏è –û—Ç–ª–∏—á–Ω–æ! –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –∫–∞–∫ –≤—Ä–∞—á –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ doctors@rozioi.pro –∏–ª–∏ –ø–æ—Å–µ—Ç–∏—Ç–µ –Ω–∞—à —Å–∞–π—Ç.",
      {
        reply_markup: new InlineKeyboard().url(
          "üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Ä–∞—á–∞",
          "https://rozioi.pro/doctor-registration",
        ),
      },
    );
  } else if (message.includes("–ø–æ–º–æ—â—å") || message.includes("help")) {
    await ctx.reply(
      "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ /start",
    );
  } else {
    await ctx.reply(
      "üîç –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—à—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤—Ä–∞—á–∞–º üëá",
      {
        reply_markup: new InlineKeyboard().webApp(
          "üë®‚Äç‚öïÔ∏è –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ",
          "https://rozioi.pro",
        ),
      },
    );
  }
});

bot.command("help", async (ctx) => {
  await ctx.reply(
    `‚ùì –ü–æ–º–æ—â—å –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ:

/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

*–ù–∞—à–∞ —Ä–æ–ª—å:* –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –º–µ–∂–¥—É –≤–∞–º–∏ –∏ –≤—Ä–∞—á–∞–º–∏
*–ì–∞—Ä–∞–Ω—Ç–∏—è:* –æ–ø–ª–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏`,
    {
      reply_markup: createMainKeyboard(),
      parse_mode: "Markdown",
    },
  );
});

export function startBot() {
  try {
    console.log("üè• Starting medical platform bot...");
    bot.start();
    console.log("‚úÖ Platform bot started successfully!");
  } catch (error) {
    console.error("‚ùå Error starting bot:", error);
  }
}

export default bot;
